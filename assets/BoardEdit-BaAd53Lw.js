import{u as F,r as m,j as i}from"./index--oy4d1LN.js";import{u as I,Q as S}from"./queryKey-C4OvowHP.js";import{u as R}from"./useMutation-BWXDtBTP.js";import{C as k}from"./category_strings-DojXDTDK.js";import{u as B,b as M}from"./board-CNwfHsRh.js";import{u as T}from"./Markdown-Cpgij77q.js";import{d as Q}from"./index-BMmima0Q.js";const r={"write-container":"_write-container_1i8jd_1","write-title":"_write-title_1i8jd_21","write-form":"_write-form_1i8jd_37","input-title":"_input-title_1i8jd_107","input-content":"_input-content_1i8jd_119","submit-button":"_submit-button_1i8jd_155","error-message":"_error-message_1i8jd_191","input-error":"_input-error_1i8jd_203","editor-error-container":"_editor-error-container_1i8jd_211","editor-container":"_editor-container_1i8jd_225","file-button":"_file-button_1i8jd_233","file-input":"_file-input_1i8jd_273","file-list":"_file-list_1i8jd_281","file-item":"_file-item_1i8jd_291","remove-button":"_remove-button_1i8jd_311"};function O({category:p}){const b=F(),[d,j]=m.useState(null),[o,f]=m.useState({}),[a,u]=m.useState({title:"",content:"",category:p,imageUrls:[],fileUrl:""}),h=window.location.href,g=h.substring(h.lastIndexOf("/")+1),_=Number(g),{editorRef:l,editorConfig:x}=T({onContentChange:t=>{u(e=>({...e,content:t})),t.trim()&&f(e=>({...e,content:void 0}))}}),s=I({queryKey:S.board.boardById(_),queryFn:()=>M(_),enabled:!!_});m.useEffect(()=>{if(s.data&&l.current){const t=s.data;u({title:t.title||"",content:t.content||"",category:t.category,imageUrls:t.imageUrls||[],fileUrl:t.fileUrl||""}),l.current.getInstance().setMarkdown(t.content||"")}},[s.data,l.current]);const v=R({mutationFn:async()=>{const t=l.current.getInstance().getMarkdown(),e=d||null,n={board:{title:a.title,content:t,imageUrls:a.imageUrls,isChangedFile:!!e,deleted:!1},file:e?e.name:null};return await B(n.board,e)},onSuccess:async()=>{alert("게시글 수정 성공"),await b(-1),setTimeout(()=>{window.scrollTo(0,0)},100)},onError:t=>{console.error("게시글 수정 실패:",t),alert("게시글 수정 실패")}}),w=t=>{const e=decodeURIComponent(t),n=e.match(/[^/]+\/[^/]+\/[a-f0-9-]+_(.+)/);return n?n[1]:e.split("/").pop()||"파일"},N=()=>{var c;const t={};let e=!0;return a.title.trim()||(t.title="제목을 입력해주세요.",e=!1),(((c=l.current)==null?void 0:c.getInstance().getMarkdown())||"").trim()||(t.content="내용을 입력해주세요.",e=!1),f(t),e},U=t=>{const{name:e,value:n}=t.target;u(c=>({...c,[e]:e==="imageUrls"?n.split(","):n})),o[e]&&f(c=>({...c,[e]:void 0}))},y=t=>{t.target.files&&t.target.files.length>0&&j(t.target.files[0])},C=()=>{j(null)},E=async t=>{t.preventDefault(),N()&&v.mutate()};return s.isLoading||s.isLoading?i.jsx("div",{children:"데이터를 불러오는 중입니다..."}):s.isError||s.isError?i.jsx("div",{children:"에러가 발생했습니다!!"}):i.jsx("div",{className:r["write-container"],children:i.jsxs("form",{className:r["write-form"],onSubmit:E,children:[i.jsxs("h2",{className:r["write-title"],children:[k[p]," 게시글 수정"]}),i.jsx("label",{htmlFor:"title",children:"제목"}),i.jsx("input",{className:`${r["input-title"]} ${o.title?r["input-error"]:""}`,type:"text",id:"title",name:"title",placeholder:"제목을 입력하세요.",value:a.title,onChange:U}),o.title&&i.jsx("p",{className:r["error-message"],children:o.title}),i.jsx("label",{htmlFor:"content",children:"내용"}),i.jsx("div",{className:`${r["editor-container"]} ${o.content?r["editor-error-container"]:""}`,children:i.jsx(Q,{ref:l,...x})}),o.content&&i.jsx("p",{className:r["error-message"],children:o.content}),i.jsx("label",{className:r["file-button"],htmlFor:"fileUpload",children:"파일 선택"}),i.jsx("input",{className:r["file-input"],type:"file",id:"fileUpload",onChange:y}),a.fileUrl&&!d&&i.jsxs("div",{className:r["file-item"],children:[w(a.fileUrl),i.jsx("button",{type:"button",className:r["remove-button"],onClick:()=>u(t=>({...t,fileUrl:""})),children:"✕"})]}),d&&i.jsxs("div",{className:r["file-item"],children:[d.name,i.jsx("button",{type:"button",className:r["remove-button"],onClick:C,children:"✕"})]}),i.jsx("div",{className:r["file-comment"],children:"파일 업로드는 한 개만 가능합니다!"}),i.jsx("input",{className:r["submit-button"],type:"submit",value:"하브루타 수정"})]})})}export{O as B};
