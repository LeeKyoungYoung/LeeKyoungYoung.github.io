import{j as e,M as E,L as y,r as d,u as R,e as S}from"./index--oy4d1LN.js";import{u as N,Q as w}from"./queryKey-C4OvowHP.js";import{b as x}from"./board-CNwfHsRh.js";import{C as b,g as B}from"./comment-CQBf1myx.js";import{C as F}from"./category_strings-DojXDTDK.js";import{G as C,s as n,c as O,D as A,d as M,F as H,B as G,I as T,a as $,C as z,b as V,e as Q}from"./like-CwNkfyO8.js";import{H as Y}from"./HeightSpacer-DEJx0swR.js";import{V as K}from"./index-BMmima0Q.js";function P(t){return C({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"},child:[]},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]}]})(t)}function W(t){return C({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2zM4 10h2v9H4v-9zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7v1.819z"},child:[]}]})(t)}const J="_link_dqv5p_65",X="_title_dqv5p_97",Z="_nav_dqv5p_115",ee="_viewContainer_dqv5p_201",te="_like_dqv5p_213",se="_activeLike_dqv5p_233",ie="_hidden_dqv5p_249",ne="_profile_dqv5p_329",ae="_writter_dqv5p_359",s={"detail-container":"_detail-container_dqv5p_3","detail-content":"_detail-content_dqv5p_27","content-body":"_content-body_dqv5p_43","divide-line":"_divide-line_dqv5p_57",link:J,"fix-button":"_fix-button_dqv5p_85",title:X,nav:Z,"nav-title":"_nav-title_dqv5p_125","nav-content":"_nav-content_dqv5p_135","content-title":"_content-title_dqv5p_145","board-content":"_board-content_dqv5p_163","comment-count":"_comment-count_dqv5p_171","stats-container":"_stats-container_dqv5p_189",viewContainer:ee,like:te,activeLike:se,"file-section":"_file-section_dqv5p_241",hidden:ie,"file-list":"_file-list_dqv5p_257","file-item":"_file-item_dqv5p_271","file-link":"_file-link_dqv5p_299",profile:ne,writter:ae},re="https://lkyoung-bucket.s3.ap-northeast-2.amazonaws.com/user/88778c10-2e63-49c4-bfd9-46c1c79e191d",ce=({closeModal:t,board:i})=>{const c="https://github.com/"+i.resUserDetailDto.githubId;return e.jsx("div",{className:n.boardContainer,children:e.jsxs(E,{className:n.boardModalContent,overlayClassName:n.boardOverlay,isOpen:!0,onRequestClose:t,children:[e.jsxs("div",{className:n["modal-body"],children:[e.jsxs("div",{className:n["first-body"],children:[e.jsx("img",{src:i.resUserDetailDto.imgUrl?i.resUserDetailDto.imgUrl:re,className:n.profile}),e.jsxs("div",{className:n["user-info"],children:[e.jsxs("div",{className:n.semester,children:["CRA ",i.resUserDetailDto.term]}),e.jsx("div",{className:n.name,children:i.resUserDetailDto.name}),e.jsx("div",{className:n["student-number"],children:i.resUserDetailDto.studentId})]})]}),e.jsx("div",{className:n.hanmadi,children:" 나의 한마디를 입력하세요. "})]}),e.jsxs("div",{className:n["extra-info"],children:[e.jsxs("div",{children:["GitHub 프로필 |"," ",e.jsx(y,{to:c,className:n.GitHubLink,target:"_blank",children:i.resUserDetailDto.githubId})]}),e.jsxs("div",{children:[" 이메일 | ",i.resUserDetailDto.email]}),e.jsx("div",{className:n.line})]})]})})},oe="https://lkyoung-bucket.s3.ap-northeast-2.amazonaws.com/user/88778c10-2e63-49c4-bfd9-46c1c79e191d",g=t=>{const i=decodeURIComponent(t),c=i.match(/[^/]+\/[^/]+\/[a-f0-9-]+_(.+)/);return c?c[1]:i.split("/").pop()||"파일"};function le({board:t,category:i,commentCount:c}){const[v,u]=d.useState(t.view),[m,o]=d.useState(!1),_=()=>o(!0),f=()=>o(!1);d.useEffect(()=>{localStorage.getItem(`viewed_${t.id}`)||O(t.id).then(()=>(localStorage.setItem(`viewed_${t.id}`,"true"),x(t.id))).then(r=>{u(r.view),console.log("Updated view count:",r.view)}).catch(r=>console.error("조회수 업데이트 실패:",r))},[t.id]);const[l,h]=d.useState(!1),[L,j]=d.useState(0);d.useEffect(()=>{(async()=>{try{const r=await x(t.id);console.log("Fetched board data:",r),j(r.likeCount??0),h(r.viewerLiked??!1)}catch(r){console.error("좋아요 상태를 가져오는 데 실패했습니다:",r)}})()},[t.id]);const U=async()=>{try{const a=await Q(t.id,!l);console.log("Response from like API:",a),h(a.liked),j(a.likes)}catch(a){console.error("좋아요 업데이트 실패:",a)}},q=async()=>{if(!t.fileUrl){alert("다운로드할 파일이 존재하지 않습니다.");return}try{const a=await fetch(t.fileUrl);if(!a.ok)throw new Error("다운로드 실패");const r=a.headers.get("content-type"),D=await a.blob(),I=new Blob([D],{type:r||"application/octet-stream"}),k=window.URL.createObjectURL(I),p=document.createElement("a");p.href=k,p.download=g(t.fileUrl),p.click(),window.URL.revokeObjectURL(k)}catch(a){console.error("파일 다운로드 실패:",a),alert("파일 다운로드에 실패했습니다. 다시 시도해 주세요.")}};return e.jsx("div",{className:s["detail-container"],children:e.jsxs("div",{className:s["detail-content"],children:[e.jsxs("div",{className:s.title,children:[F[i]," 게시판"]}),e.jsx(A,{}),e.jsxs("div",{className:s["content-body"],children:[e.jsxs("div",{className:s.nav,children:[e.jsxs("div",{className:s.writter,children:[e.jsx("span",{className:s["nav-title"],children:"작성자 | "}),e.jsxs("div",{children:[e.jsx("img",{src:t.resUserDetailDto.imgUrl?t.resUserDetailDto.imgUrl:oe,className:s.profile,onClick:_}),m&&e.jsx(ce,{closeModal:f,board:t})]}),e.jsx("span",{className:s["nav-content"],children:t.resUserDetailDto.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:s["nav-title"],children:"작성일 | "}),e.jsx("span",{className:s["nav-content"],children:M(t.createdAt)})]}),e.jsxs("div",{className:s["fix-button"],children:[e.jsx(y,{to:`/${b[i]}/edit/${t.id}`,className:s.link,children:e.jsx(H,{size:22})}),e.jsx(G,{id:t.id,category:i})]})]}),e.jsx("div",{className:s["content-title"],children:t.title}),e.jsx("div",{className:s["board-content"],children:e.jsx(K,{initialValue:t.content})}),e.jsxs("div",{className:s["comment-count"],children:[e.jsx("div",{className:s["file-section"],children:t.fileUrl?e.jsx("div",{className:s["file-item"],children:e.jsxs("a",{onClick:q,style:{cursor:"pointer"},className:s["file-link"],children:[e.jsx(T,{})," ",g(t.fileUrl)]})}):e.jsx("div",{style:{visibility:"hidden"},children:" "})}),e.jsxs("div",{className:s["stats-container"],children:[e.jsxs("span",{className:s.viewContainer,children:[e.jsx(P,{}),e.jsx("span",{children:v})]}),e.jsxs("span",{className:s.viewContainer,children:[e.jsx("span",{onClick:U,className:s.like,children:e.jsx(W,{className:l?s.activeLike:""})}),e.jsx("span",{children:L})]}),e.jsxs("span",{className:s.viewContainer,children:[e.jsx($,{}),e.jsx("span",{children:c})]})]})]})]}),e.jsxs("div",{className:s.footer,children:[e.jsx(Y,{space:20}),e.jsx(z,{id:t.id}),e.jsx(V,{parentId:void 0})]})]})})}const de={"full-width":"_full-width_1cq9d_1"};function je({category:t}){const i=window.location.href,c=i.substring(i.lastIndexOf("/")+1),v=Number(c),u=R(),m=d.useRef(!1),o=N({queryKey:w.board.boardById(v),queryFn:async()=>x(v),retry:!1}),_=N({queryKey:w.comment.commentsCountById(v),queryFn:async()=>B(v),retry:!1});return d.useEffect(()=>{var f;if(!m.current&&o.isError){const l=o.error;if(S.isAxiosError(l)){const h=(f=l.response)==null?void 0:f.status;if(h===404){m.current=!0,u("/not-found");return}if(h===403){m.current=!0,u("/forbidden");return}if(h===500){m.current=!0,u("/internal-server-error",{state:{message:l.message}});return}}m.current=!0,u("/internal-server-error",{state:{message:l instanceof Error?l.message:"Unknown error"}});return}}),o.isFetching||_.isFetching?e.jsx("div",{children:"로딩 중..."}):o.isSuccess&&_.isSuccess?e.jsx("div",{className:de["full-width"],children:e.jsx(le,{board:o.data,category:t,commentCount:_.data})}):e.jsx("div",{children:"데이터를 불러올 수 없습니다."})}export{je as B};
