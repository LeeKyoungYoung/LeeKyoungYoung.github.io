import{u as F,r as h,j as e}from"./index--oy4d1LN.js";import{u as E,Q as I}from"./queryKey-C4OvowHP.js";import{u as S}from"./useMutation-BWXDtBTP.js";import{c as k}from"./board-CNwfHsRh.js";import{g as R}from"./havruta-Di_6p_ps.js";import{C as T}from"./category-CfUmwj9X.js";import{u as A}from"./Markdown-Cpgij77q.js";import{d as M}from"./index-BMmima0Q.js";import"./utils-km2FGkQ4.js";const o={"write-container":"_write-container_at2wo_1","write-title":"_write-title_at2wo_21","write-form":"_write-form_at2wo_41","input-title":"_input-title_at2wo_111","input-content":"_input-content_at2wo_127","file-button":"_file-button_at2wo_219","file-input":"_file-input_at2wo_259","file-list":"_file-list_at2wo_267","file-item":"_file-item_at2wo_277","remove-button":"_remove-button_at2wo_297","submit-button":"_submit-button_at2wo_313","error-message":"_error-message_at2wo_349","input-error":"_input-error_at2wo_361","editor-error-container":"_editor-error-container_at2wo_369","editor-container":"_editor-container_at2wo_383","file-comment":"_file-comment_at2wo_391"};function Q(){var g,v;const _=T.HAVRUTA,w=F(),[u,m]=h.useState(null),[i,d]=h.useState({}),[s,c]=h.useState({title:"",content:"",category:_,imageUrls:[],havrutaDto:{id:null,classname:"",professor:""}}),{editorRef:f,editorConfig:x}=A({onContentChange:t=>{c(r=>({...r,content:t})),t.trim()&&d(r=>({...r,content:void 0}))}}),l=E({queryKey:I.havruta.havrutas(),queryFn:async()=>R()}),j=S({mutationFn:async()=>{const t=f.current.getInstance().getMarkdown(),r=u||null,a={board:{title:s.title,content:t,category:s.category,imageUrls:s.imageUrls,havrutaDto:s.havrutaDto,resUserDetailDto:{name:"사용자 이름",email:"user@example.com",studentId:12345678,term:"2025-1",githubId:"githubUsername",imgUrl:"https://example.com/profile.jpg"}},file:r?[r.name]:[]};return console.log(a.board),await k({...a.board,likes:0,liked:!1},r)},onSuccess:async()=>{alert("게시글 작성 성공"),await w(-1),setTimeout(()=>{window.scrollTo(0,0)},100),c({title:"",content:"",category:_,imageUrls:[],havrutaDto:{id:null,classname:"",professor:""}}),m(null)},onError:t=>{console.error("게시글 작성 실패:",t),alert("게시글 작성 실패")}}),b=()=>{var n;const t={};let r=!0;return s.title.trim()||(t.title="제목을 입력해주세요.",r=!1),(((n=f.current)==null?void 0:n.getInstance().getMarkdown())||"").trim()||(t.content="내용을 입력해주세요.",r=!1),d(t),r},y=t=>{const{name:r,value:a}=t.target;c(n=>({...n,[r]:r==="imageUrls"?a.split(","):a})),i[r]&&d(n=>({...n,[r]:void 0}))},N=t=>{t.target.files&&t.target.files.length>0&&m(t.target.files[0])},U=()=>{m(null)},C=t=>{var n;const r=parseInt(t.target.value,10),a=(n=l.data)==null?void 0:n.find(p=>p.id===r);if(!a){console.error("선택한 하브루타 과목을 찾을 수 없습니다.");return}console.log("선택한 과목:",a==null?void 0:a.className,a==null?void 0:a.professor),c(p=>({...p,havrutaDto:{id:a.id??null,classname:a.className||"",professor:a.professor||""}}))},D=t=>{t.preventDefault(),b()&&j.mutate()};return e.jsx("div",{className:o["write-container"],children:e.jsxs("form",{className:o["write-form"],onSubmit:D,children:[e.jsx("h2",{className:o["write-title"],children:"하브루타 게시글 작성"}),e.jsx("label",{htmlFor:"title",children:"제목"}),e.jsx("input",{className:`${o["input-title"]} ${i.title?o["input-error"]:""}`,type:"text",id:"title",name:"title",placeholder:"제목을 입력하세요.",value:s.title,onChange:y}),i.title&&e.jsx("p",{className:o["error-message"],children:i.title}),e.jsx("label",{htmlFor:"havrutaId",children:"과목명"}),l.isLoading?e.jsx("p",{children:"과목 목록을 불러오는 중입니다..."}):l.isError?e.jsx("p",{children:"과목 목록을 불러오는데 실패했습니다."}):((g=l.data)==null?void 0:g.length)===0?e.jsx("p",{children:"사용 가능한 과목이 없습니다."}):e.jsxs("select",{id:"havrutaId",name:"havrutaId",value:s.havrutaDto.id||"",onChange:C,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"하브루타 과목을 선택하세요"}),(v=l.data)==null?void 0:v.map(t=>e.jsxs("option",{value:t.id,children:[t.className," (",t.professor,")"]},t.id))]}),e.jsx("label",{htmlFor:"content",children:"내용"}),e.jsx("div",{className:`${o["editor-container"]} ${i.content?o["editor-error-container"]:""}`,children:e.jsx(M,{ref:f,...x})}),i.content&&e.jsx("p",{className:o["error-message"],children:i.content}),e.jsx("label",{className:o["file-button"],htmlFor:"fileUpload",children:"파일 선택"}),e.jsx("input",{className:o["file-input"],type:"file",id:"fileUpload",onChange:N}),u&&e.jsxs("div",{className:o["file-item"],children:[u.name,e.jsx("button",{type:"button",className:o["remove-button"],onClick:U,children:"✕"})]}),e.jsx("div",{className:o["file-comment"],children:"파일 업로드는 한 개만 가능합니다!"}),e.jsx("input",{className:o["submit-button"],type:"submit",value:"게시글 작성"})]})})}function L(){return e.jsx("div",{children:e.jsx(Q,{})})}export{L as default};
