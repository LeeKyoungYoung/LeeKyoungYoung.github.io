import{r as l,j as e,L as I,u as k,e as U}from"./index--oy4d1LN.js";import{u as p,Q as w}from"./queryKey-C4OvowHP.js";import{b as g}from"./board-CNwfHsRh.js";import{C as S,g as B}from"./comment-CQBf1myx.js";import{C as E}from"./category-CfUmwj9X.js";import{c as L,D as Y,d as F,F as R,B as D,I as K,C as O,b as G,e as V}from"./like-CwNkfyO8.js";import{H as M}from"./HeightSpacer-DEJx0swR.js";import{V as Q}from"./index-BMmima0Q.js";import"./utils-km2FGkQ4.js";import"./useMutation-BWXDtBTP.js";import"./WidthSpacer-DVNpzZo4.js";const b="_link_7m99e_65",H="_title_7m99e_97",T="_nav_7m99e_115",X="_viewContainer_7m99e_189",n={"detail-container":"_detail-container_7m99e_3","detail-content":"_detail-content_7m99e_27","content-body":"_content-body_7m99e_43","divide-line":"_divide-line_7m99e_57",link:b,"fix-button":"_fix-button_7m99e_85",title:H,nav:T,"nav-title":"_nav-title_7m99e_125","nav-content":"_nav-content_7m99e_135","content-title":"_content-title_7m99e_145","board-content":"_board-content_7m99e_163","comment-count":"_comment-count_7m99e_171",viewContainer:X,"file-section":"_file-section_7m99e_201","file-list":"_file-list_7m99e_209","file-item":"_file-item_7m99e_223","file-link":"_file-link_7m99e_245"},W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAQCAYAAADj5tSrAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAH+SURBVHgBpVTLccIwELU9wJlUEKcCSAVxOqAD8AEYTpgKEBVgjnxmIB0kFQQqCKkgpANy5Zv3YJ1RhEQO0Yws26t9b3f1Vr53ZUyn0+Jms6n5vl8KgiA6Ho9F/C6KeYnvFdaX/X4/b7VaKxeO7wLfbrcK4FWCAmxBUJkeyWAL8VrG+iD/ZiDr2cguSIbDYYKou/I5yOVyaRzHa8+dbYiAIvocDgeSDZrNZuokGY/HfSwJN+bzeaWDa6ULWSYAPutR045MFGxtfKp6vd67INEI4kajMXNlB/sniG6989n8AhOcBAuxUtg6/BeIoesiGI1GNRD0YXtC6e5gL8P5BiaCK/hG+n7YUuIQj8GdMmFNd7vdB52wQXnGAMgbnJYAjy22VwF+tNgUli587wMQTFljG4GMMubCZmB2WCKbTfCWKG3/VC68ONXznwFcyt8P8ODhlOVcbGMu/WIDiTzpHXMQD9ghFFcLUGtuIpGaTCY2MB5wpAdBuYoaq5S76SA4ir6Uua8ZqIo29N8xmyk7REyWdYUZZgFQTSYBu5/kSOCsLgdYCrn2jGYM0YyVrBkLhcLMbFaIKGuFH4ILEiFKAMSMTpH+dfkJOLs8cWXnuiDZOwqv2RnNEd07M9CUyMux5J0lvKaczavoKolOxssPrxXMUEA5CPSFbOdYl2bpzPENfBZex3c7YKQAAAAASUVORK5CYII=",C=t=>{const o=decodeURIComponent(t),r=o.match(/[^/]+\/[^/]+\/[a-f0-9-]+_(.+)/);return r?r[1]:o.split("/").pop()||"파일"};function Z({board:t,category:o,commentCount:r}){var _,h;const[A,d]=l.useState(t.view);l.useEffect(()=>{localStorage.getItem(`viewed_${t.id}`)||L(t.id).then(()=>(localStorage.setItem(`viewed_${t.id}`,"true"),g(t.id))).then(i=>{d(i.view),console.log("Updated view count:",i.view)}).catch(i=>console.error("조회수 업데이트 실패:",i))},[t.id]);const[a,c]=l.useState(!1),[u,v]=l.useState(t.likes);l.useEffect(()=>{const s=localStorage.getItem(`isLiked_${t.id}`);s&&c(JSON.parse(s))},[t.id]);const m=async()=>{if(t.userId===void 0){console.error("유효하지 않은 사용자 ID");return}const s=!a;try{await V(t.id,a),c(s),v(i=>s?i+1:i-1),localStorage.setItem(`isLiked_${t.id}`,JSON.stringify(s))}catch(i){console.error("좋아요 업데이트 실패:",i)}},f=async()=>{if(!t.fileUrl){alert("다운로드할 파일이 존재하지 않습니다.");return}try{const s=await fetch(t.fileUrl);if(!s.ok)throw new Error("다운로드 실패");const i=s.headers.get("content-type"),y=await s.blob(),N=new Blob([y],{type:i||"application/octet-stream"}),j=window.URL.createObjectURL(N),x=document.createElement("a");x.href=j,x.download=C(t.fileUrl),x.click(),window.URL.revokeObjectURL(j)}catch(s){console.error("파일 다운로드 실패:",s),alert("파일 다운로드에 실패했습니다. 다시 시도해 주세요.")}};return e.jsx("div",{className:n["detail-container"],children:e.jsxs("div",{className:n["detail-content"],children:[e.jsxs("div",{className:n.title,children:[(_=t.havrutaDto)==null?void 0:_.classname," (",(h=t.havrutaDto)==null?void 0:h.professor,")"]}),e.jsx(Y,{}),e.jsxs("div",{className:n["content-body"],children:[e.jsxs("div",{className:n.nav,children:[e.jsxs("div",{children:[e.jsx("span",{className:n["nav-title"],children:"작성자 | "}),e.jsx("span",{className:n["nav-content"],children:t.userId})]}),e.jsxs("div",{children:[e.jsx("span",{className:n["nav-title"],children:"작성일 | "}),e.jsx("span",{className:n["nav-content"],children:F(t.createdAt)})]}),e.jsxs("div",{className:n["fix-button"],children:[e.jsx(I,{to:`/${S[o]}/edit/${t.id}`,className:n.link,children:e.jsx(R,{size:22})}),e.jsx(D,{id:t.id,category:o})]})]}),e.jsx("div",{className:n["content-title"],children:t.title}),e.jsx("div",{className:n["board-content"],children:e.jsx(Q,{initialValue:t.content})}),e.jsxs("div",{className:n["comment-count"],children:[t.fileUrl&&e.jsx("div",{className:n["file-section"],children:e.jsx("div",{className:n["file-item"],children:e.jsxs("a",{onClick:f,style:{cursor:"pointer"},className:n["file-link"],children:[e.jsx(K,{})," ",C(t.fileUrl)]})})}),e.jsxs("span",{className:n.viewContainer,children:[e.jsx("img",{src:W}),e.jsx("span",{children:A})]}),e.jsxs("span",{className:n.viewContainer,children:[e.jsx("button",{onClick:m,children:a?"좋아요 취소":"좋아요"}),e.jsx("span",{children:u})]}),e.jsxs("span",{className:n.viewContainer,children:[e.jsx("span",{children:"댓글"}),e.jsx("span",{children:r})]})]})]}),e.jsxs("div",{className:n.footer,children:[e.jsx(M,{space:20}),e.jsx(O,{id:t.id}),e.jsx(G,{parentId:void 0})]})]})})}const q={"full-width":"_full-width_1cq9d_1"};function J(){const t=window.location.href,o=t.substring(t.lastIndexOf("/")+1),r=Number(o),A=E.HAVRUTA,d=k(),a=l.useRef(!1),c=p({queryKey:w.board.boardById(r),queryFn:async()=>g(r),retry:!1}),u=p({queryKey:w.comment.commentsCountById(r),queryFn:async()=>B(r),retry:!1});return l.useEffect(()=>{var v;if(!a.current&&c.isError){const m=c.error;if(U.isAxiosError(m)){const f=(v=m.response)==null?void 0:v.status;if(f==404){a.current=!0,d("/not-found");return}if(f==403){a.current=!0,d("/forbidden");return}if(f==500){a.current=!0,d("/internal-server-error");return}}a.current=!0,d("/internal-server-error",{state:{message:m instanceof Error?m.message:"Unknown error"}});return}}),c.isFetching||u.isFetching?e.jsx("div",{children:"로딩 중..."}):c.isSuccess&&u.isSuccess?e.jsx("div",{className:q["full-width"],children:e.jsx(Z,{board:c.data,category:A,commentCount:u.data})}):e.jsx("div",{children:"데이터를 불러올 수 없습니다."})}function oe(){return e.jsx("div",{children:e.jsx(J,{})})}export{oe as default};
